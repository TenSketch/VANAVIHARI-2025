# Tent ID Auto-Generation Implementation

## Overview
Implemented automatic tent ID generation based on tent spot prefix in the format: `PREFIX-T-##`

## Example
- Tent Spot Prefix: `VM`
- First Tent: `VM-T-01`
- Second Tent: `VM-T-02`
- Third Tent: `VM-T-03`

## Backend Changes

### 1. Tent Spot Model (`backend/models/tentSpotModel.js`)
**Added Field:**
- `tentIdPrefix` (String, required) - Prefix for generating tent IDs (e.g., "VM", "VH")

### 2. Tent Spot Controller (`backend/controllers/tentSpotController.js`)
**Updated:**
- Added `tentIdPrefix` to validation
- Added `tentIdPrefix` to tent spot creation

### 3. Tent Controller (`backend/controllers/tentController.js`)
**Updated `createTent`:**
- Removed `tentId` from required fields (now auto-generated)
- Auto-generates tent ID based on tent spot prefix
- Format: `{prefix}-T-{number}`
- Finds last tent with same prefix and increments number
- Numbers are zero-padded to 2 digits (01, 02, etc.)

**Added `getNextTentId`:**
- New endpoint to fetch next available tent ID
- Used by frontend to show preview before submission
- Returns: `{ success: true, nextTentId: "VM-T-01", prefix: "VM" }`

### 4. Tent Routes (`backend/routes/tentRoutes.js`)
**Added Route:**
- `GET /api/tents/next-tent-id/:tentSpotId` - Get next available tent ID

## Frontend Changes

### 1. Add Tent Spot Form (`admin/src/components/tentSpots/AddTentSpots.tsx`)
**Added Field:**
- Tent ID Prefix input field (required)
- Placeholder: "e.g., VM, VH"
- Max length: 5 characters
- Help text: "This will be used to generate tent IDs (e.g., VM-T-01)"

### 2. Add Tent Form (`admin/src/components/tentInventory/AddTents.tsx`)
**Updated:**
- Tent ID field is now read-only (auto-generated)
- Auto-fetches next tent ID when tent spot is selected
- Uses `useEffect` to call `/api/tents/next-tent-id/:tentSpotId`
- Displays auto-generated ID before submission
- Removed `tentId` from form submission (generated by backend)

## How It Works

### Creating a Tent Spot:
1. Admin fills in tent spot details
2. Enters a Tent ID Prefix (e.g., "VM")
3. Submits form
4. Prefix is saved with tent spot

### Creating a Tent:
1. Admin selects a tent spot from dropdown
2. Frontend automatically fetches next available tent ID
3. Tent ID is displayed (e.g., "VM-T-01")
4. Admin fills in other details
5. Submits form
6. Backend generates final tent ID and saves tent

### Tent ID Generation Logic:
```javascript
// Find last tent with this prefix
const lastTent = await Tent.findOne({ 
  tentId: new RegExp(`^${prefix}-T-\\d+$`),
  tentSpot: tentSpotId
}).sort({ createdAt: -1 });

// Get next number
let nextNumber = 1;
if (lastTent && lastTent.tentId) {
  const match = lastTent.tentId.match(/\d+$/);
  if (match) {
    nextNumber = parseInt(match[0]) + 1;
  }
}

// Generate ID with zero-padding
const tentId = `${prefix}-T-${String(nextNumber).padStart(2, '0')}`;
```

## API Endpoints

### Get Next Tent ID
```
GET /api/tents/next-tent-id/:tentSpotId
```

**Response:**
```json
{
  "success": true,
  "nextTentId": "VM-T-01",
  "prefix": "VM"
}
```

### Create Tent
```
POST /api/tents
Headers: { "Authorization": "Bearer token" }
Body: FormData
  - tentSpot: "tent_spot_id"
  - tentType: "tent_type_id"
  - noOfGuests: 4
  - rate: 3500
  - images: [files]
```

**Note:** `tentId` is NOT sent - it's auto-generated by backend

## Testing

### 1. Create a Tent Spot
- Spot Name: "Vanavihari Marecumilli"
- Tent ID Prefix: "VM"
- Fill other required fields
- Submit

### 2. Create First Tent
- Select "Vanavihari Marecumilli" as tent spot
- Tent ID should auto-fill: "VM-T-01"
- Fill other fields
- Submit

### 3. Create Second Tent
- Select same tent spot
- Tent ID should auto-fill: "VM-T-02"
- Submit

### 4. Create Tent at Different Spot
- Create another tent spot with prefix "VH"
- Create tent there
- Tent ID should be: "VH-T-01"

## Benefits
✅ No manual tent ID entry
✅ Consistent ID format
✅ No duplicate IDs
✅ Sequential numbering per tent spot
✅ Easy to identify which spot a tent belongs to
✅ Preview ID before submission

## Migration Note
If you have existing tent spots without `tentIdPrefix`:
1. Update each tent spot to add a prefix
2. Or set a default prefix in the model
3. Existing tents keep their current IDs
4. New tents will use the auto-generation system
